ver=6.2
src=https://ftp.gnu.org/pub/gnu/ncurses/ncurses-$ver.tar.gz
files=(lib/libncursesw.a)

configure() {
  ln -s termcap.h include/termcap_internal.h

  t=ncurses/tinfo
  for culprit in progs/tset.c $t/lib_baudrate.c $t/lib_cur_term.c $t/lib_termcap.c $t/lib_tgoto.c $t/lib_tputs.c ; do
    sed -i 's@termcap\.h@termcap_internal.h@' $culprit
  done

  CFLAGS="$CFLAGS -D_GNU_SOURCE" \
  $CONFIGURE -C \
    --includedir=$INCLUDE_PREFIX \
    --mandir=$MAN_PREFIX \
    --with-default-terminfo-dir=$SHARE_PREFIX/terminfo \
    --with-pkg-config-libdir=$LIB_PREFIX/pkgconfig \
    --with-terminfo-dirs="$ETC_PREFIX/terminfo:$SHARE_PREFIX/terminfo" \
    --with-normal \
    --without-tests \
    --enable-widec \
    --with-shared \
    --enable-sigwinch \
    --with-fallbacks="linux vt100 xterm xterm256-color" \
    --disable-nls \
    --without-dlsym \
    --without-cxx-binding
}

install() {
  cd $LIB

  for i in  lib*.* ; do
    l=$(echo $i | awk '{ p = index($1, "."); if(substr($1, p-1, 1) == "w") { a = substr($1, 0, p -2);} else { a = substr($1, 0, p -4) "_g"; } ; b = substr ($1, p); $0 = a b; print; }')
    ln -s "$i" "$l"
  done

  ar rc libterminfo.a
  ln -sf libncurses.a libcurses.a
  ln -sf libncurses.so libcurses.so
}